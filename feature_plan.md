# Keeper Credential PDF Generator Feature and Development Plan

Below is the detailed **Feature and Development Plan** based on your requirements, clarifications, and my research/validation. I've structured it for clarity, ensuring it aligns with the minimal footprint (using standard Keeper Commander CLI/SDK, all data in the Keeper Vault [[memory:3992481]]), persistent master password login to avoid SSO issues [[memory:498900]]), and no git operations (user handles those [[memory:4180104]] [[memory:4179586]])). The plan assumes a Python script as the implementation, running under an admin account with full vault permissions.

If anything in this plan doesn't match your expectations, let me know, and I can refine it before any coding begins.

---

### 1. Feature Overview
**Feature Name**: Keeper Credential PDF Generator

**Description**: A Python command-line tool that automates the creation of customer-specific credential structures in the Keeper Vault, autogenerates secure credentials, populates a Word document template with those credentials, generates a PDF, and stores it back in the vault. The tool supports interactive prompts for key inputs (e.g., template UIDs and folders), bulk processing via CSV or CLI arguments, and secure sharing via Keeper's one-time share links (displayed for manual emailing). All operations are vault-centric with zero local storage or memory footprint.

**Goal**: Enable a web development company to efficiently generate and securely share PDF documents containing autogenerated credentials for their customers, all managed within Keeper Password Manager.

**Key Benefits**:
- Secure: Credentials never leave the vault; PDFs are generated in memory and uploaded.
- Efficient: Bulk support for multiple customers; interactive mode for single runs.
- Compliant: Uses Keeper's built-in features for autogeneration, attachments, and sharing.

**Scope Limitations**:
- No automated emailing (per your clarification—links are generated and displayed only).
- Assumes Windows OS (for PDF conversion tool; can be adapted if needed).
- Does not handle multi-user sessions; script runs with full admin perms and sets ACLs on new items.

---

### 2. Requirements Breakdown
Based on your query and clarifications, here are the detailed functional and non-functional requirements.

#### Functional Requirements
1. **Interactive Mode**:
   - Prompt the user for:
     - Record UID of the JSON template (stored in the vault as a record attachment or note).
     - Record UID of the Word document template (stored in the vault as a file attachment).
     - Source folder UID/path (where templates are retrieved from).
     - Target folder UID/path (where new customer structures and PDFs are stored).
   - Use simple console prompts (e.g., `input("Enter JSON template record UID: ")`) with basic validation (e.g., check if UID exists via Keeper SDK's `get_record()` and retry on invalid input).
   - For single-customer runs: Also prompt for customer details (e.g., name, any custom params).

2. **JSON Template Handling**:
   - The script downloads the JSON template from the specified vault record/attachment.
   - Use a placeholder-based structure (created as a sample—see Section 5 below). The JSON defines:
     - Folder hierarchy (e.g., root folder per customer with subfolders).
     - Records (e.g., type like "login", fields like username/password, with placeholders for autogeneration like "$GEN" for passwords).
   - For each customer instance:
     - Parse the JSON and create the folder structure using Keeper SDK (e.g., `mkdir` command or API).
     - Autogenerate credentials (e.g., passwords via Keeper's generator with customizable rules).
     - Apply the template to create records in the new folders.

3. **Credential Autogeneration**:
   - Triggered during customer instance creation (not template creation).
   - Use Keeper Commander's built-in password generator (from `generator.py`) for fields marked with placeholders like "$GEN".
   - Support custom rules (e.g., via JSON params: {"length": 16, "upper": 4, "lower": 4, "digits": 4, "symbols": 4}).

4. **Word Template and PDF Generation**:
   - Download the Word (.docx) template from the vault (via Keeper SDK's attachment download).
   - Placeholders in the Word doc use Jinja2 syntax (e.g., `{{ customer_name }}`, `{{ record_login_password }}`) for fields from all records in the customer's folder.
   - Fill placeholders using `docxtpl` library (lightweight, processes in memory).
   - Convert filled .docx to PDF using `win32com.client` (Windows-native Word COM API via pywin32 for minimal deps).
   - Generate one PDF per customer, listing all credentials from the folder's records.
   - Upload the PDF back to the vault as an attachment to a new record in the target folder.

5. **Bulk Creation**:
   - **CSV Input**: Accept a CSV file path via CLI (e.g., `--csv path/to/file.csv`). Format: Columns like `customer_name,email,custom_param1,custom_param2` (one row per customer).
   - **CLI Arguments**: Support repeatable flags like `--customer "name:email:custom_param1"` (e.g., repeat for multiples: `script.py --customer "ClientA:clienta@email.com:extra" --customer "ClientB:..."`).
   - Process in a loop: For each customer, apply the JSON template, autogenerate creds, generate PDF, and store in vault.
   - Handle errors by continuing (skip failed customers, log issues) but rolling back partial vault changes (e.g., delete incomplete folders/records).

6. **Sharing**:
   - After PDF creation, generate a Keeper one-time share link for the PDF record using SDK commands (e.g., `one-time-share-create`).
   - Display the link in the console for manual emailing (e.g., "One-Time Share Link for ClientA: https://...").

7. **Access Controls**:
   - Script assumes full admin permissions.
   - When creating folders/records, set ACLs programmatically (e.g., via Keeper SDK: read-only for customers, full access for admins) to enforce "different users have different access."

8. **Authentication**:
   - Use persistent login with master password (via Keeper SDK's login persistence) for non-interactive stability.

#### Non-Functional Requirements
- **Performance**: Handle up to 50 customers in bulk efficiently (vault ops are API-based, so scalable).
- **Security**: All data processed in memory; no local files. Use HTTPS for Keeper API.
- **Error Handling**: Log errors (e.g., invalid UIDs, generation failures) to console; continue in bulk mode with summaries.
- **Dependencies**: Minimal—Keeper Commander SDK (already cloned), `docxtpl`, `pywin32` (for PDF conversion). No heavy frameworks.
- **Platform**: Windows-compatible (your OS: win32 10.0.26100).
- **Output**: Console logs for progress; no GUI.

#### Edge Cases
- **Access Controls**: Test scenarios where ACLs restrict non-admin access (e.g., simulate customer login failing to edit).
- **Bulk Failures**: E.g., invalid CSV row skips that customer but processes others.
- **Large Datasets**: Handle folders with 100+ records (chunk API calls if needed).
- **Invalid Inputs**: E.g., non-existent UIDs prompt for retry.
- **International Characters**: Ensure UTF-8 support in placeholders/creds/PDFs.
- **Vault Limits**: Check Keeper quotas (e.g., attachment size < 100MB) and handle gracefully.

---

### 3. Development Plan
**Tech Stack**:
- **Language**: Python 3.x.
- **Core Library**: Keeper Commander SDK (use the cloned repo for integration).
- **Additional Libs**: `docxtpl` (placeholder filling), `pywin32` (PDF conversion), `csv` and `argparse` (built-in for input handling).
- **Environment**: Run from your workspace (/c%3A/Users/MartinSawczyn/Github/Kunze); no server needed.

**High-Level Steps**:
1. **Setup (1-2 hours)**: Install minimal deps (pip install docxtpl pywin32). Integrate Keeper SDK into a new script file (e.g., keeper_pdf_generator.py).
2. **Authentication Module (2 hours)**: Implement persistent login with master password prompt (fallback to interactive if needed).
3. **Interactive Prompts (2-3 hours)**: Add console inputs for UIDs/folders with validation loops.
4. **Template Parsing and Creation (4-6 hours)**: Download/parse JSON, create folders/records, autogenerate creds.
5. **PDF Generation (3-4 hours)**: Download Word template, fill with docxtpl, convert to PDF with win32com, upload to vault.
6. **Bulk Support (2-3 hours)**: Add CSV parsing and repeatable CLI args via argparse.
7. **Sharing and ACLs (2 hours)**: Generate one-time links; set permissions on creation.
8. **Error Handling and Logging (2 hours)**: Implement try-except blocks, rollback logic, console summaries.
9. **Testing (4-6 hours)**: Unit tests for modules; end-to-end with mock vault data. Cover edge cases.

**Timeline Estimate**: 20-30 hours total (1-2 weeks part-time), assuming no major blockers. Start with a prototype for interactive single-customer mode, then add bulk.

**Milestones**:
- **Prototype**: Basic interactive PDF generation (1 week).
- **Full Feature**: Add bulk, sharing, ACLs (additional 1 week).
- **Testing/Refinement**: Validate with real vault data.

**Risks and Mitigations**:
- PDF Conversion Issues: Fallback to docx2pdf if win32com fails.
- Keeper API Limits: Implement retries for rate limiting.
- Dependencies: All are lightweight; test on your Windows setup.

---

### 4. Sample Implementation Notes
- **Script Usage Example**:
  ```
  python keeper_pdf_generator.py --bulk --csv customers.csv
  # Or interactive: python keeper_pdf_generator.py
  ```
- **Flow Diagram** (Text-Based):
  - Start → Authenticate → Prompt for UIDs/Folders → Download Templates → For each customer: Parse JSON → Create Structure → Autogenerate Creds → Fill Word → Generate PDF → Upload PDF → Set ACLs → Generate Share Link → Display Link.

---

### 5. Sample JSON Template (Placeholders)
Here's a placeholder JSON template you can store in the vault (as a record note or attachment). Customize it as needed—the script will parse and fill dynamically (e.g., replace "${customer_name}" with input, "$GEN" with generated password).

```json
{
  "root_folder": "${customer_name}_Credentials",
  "subfolders": ["Logins", "Databases"],
  "records": [
    {
      "folder": "Logins",
      "type": "login",
      "title": "${customer_name}_Admin_Login",
      "fields": {
        "login": "${customer_name}_admin",
        "password": "$GEN",  // Autogenerate password
        "url": "https://example.com",
        "notes": "Autogenerated on ${date}"
      },
      "autogen_rules": {"length": 16, "upper": 4, "lower": 4, "digits": 4, "symbols": 4}
    },
    {
      "folder": "Databases",
      "type": "database",
      "title": "${customer_name}_DB_Access",
      "fields": {
        "host": "db.example.com",
        "username": "${customer_name}_dbuser",
        "password": "$GEN",
        "database": "${customer_name}_db"
      }
    }
  ]
}
```

This plan is ready for implementation. If you'd like me to start coding (e.g., create the script file) or adjust anything, just say the word! 